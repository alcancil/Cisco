# √çndice

- [√çndice](#√≠ndice)
  - [04 - PIM - Rendezvous Points (RPs)](#04---pim---rendezvous-points-rps)
  - [O que √© um Rendezvous Point (RP)?](#o-que-√©-um-rendezvous-point-rp)
    - [Representa√ß√£o Visual do RP](#representa√ß√£o-visual-do-rp)
    - [Funcionamento do RP](#funcionamento-do-rp)
    - [Por que precisamos de um RP?](#por-que-precisamos-de-um-rp)
  - [Tipos de Configura√ß√£o de RP](#tipos-de-configura√ß√£o-de-rp)
    - [1. Static RP (RP Est√°tico)](#1-static-rp-rp-est√°tico)
    - [2. Auto-RP (Cisco Propriet√°rio)](#2-auto-rp-cisco-propriet√°rio)
    - [3. Bootstrap Router (BSR) - RFC 5059](#3-bootstrap-router-bsr---rfc-5059)
    - [4. Anycast RP - RFC 4610](#4-anycast-rp---rfc-4610)
    - [5. Embedded RP (IPv6)](#5-embedded-rp-ipv6)
  - [Processo de Funcionamento do RP](#processo-de-funcionamento-do-rp)
    - [Fluxograma - Processo Completo do RP](#fluxograma---processo-completo-do-rp)
  - [Configura√ß√£o de RPs](#configura√ß√£o-de-rps)
    - [Static RP - Configura√ß√£o Manual](#static-rp---configura√ß√£o-manual)
    - [Auto-RP - Configura√ß√£o Cisco](#auto-rp---configura√ß√£o-cisco)
    - [BSR - Configura√ß√£o Padr√£o RFC](#bsr---configura√ß√£o-padr√£o-rfc)
    - [Anycast RP - Alta Disponibilidade](#anycast-rp---alta-disponibilidade)
  - [Sele√ß√£o e Descoberta de RPs](#sele√ß√£o-e-descoberta-de-rps)
    - [Processo de Sele√ß√£o do RP](#processo-de-sele√ß√£o-do-rp)
    - [Hash Function para Sele√ß√£o de RP](#hash-function-para-sele√ß√£o-de-rp)
  - [RP Tree vs Source Tree](#rp-tree-vs-source-tree)
    - [Compara√ß√£o Visual](#compara√ß√£o-visual)
    - [SPT Switchover - Migra√ß√£o para Source Tree](#spt-switchover---migra√ß√£o-para-source-tree)
  - [Troubleshooting de RPs](#troubleshooting-de-rps)
    - [Comandos de Verifica√ß√£o](#comandos-de-verifica√ß√£o)
    - [Problemas Comuns](#problemas-comuns)
  - [Otimiza√ß√£o e Melhores Pr√°ticas](#otimiza√ß√£o-e-melhores-pr√°ticas)
    - [Placement Strategy (Estrat√©gia de Posicionamento)](#placement-strategy-estrat√©gia-de-posicionamento)
    - [Redund√¢ncia e Failover](#redund√¢ncia-e-failover)

## 04 - PIM - Rendezvous Points (RPs)

## O que √© um Rendezvous Point (RP)?

O **Rendezvous Point (RP)** √© o componente central do PIM Sparse Mode, funcionando como um "ponto de encontro" onde origens multicast se registram e receptores se conectam para descobrir e receber fluxos multicast.

### Representa√ß√£o Visual do RP

```text
Conceito do RP - "Ponto de Encontro Central":

üî∫ Source A ‚îÄ‚îÄRegister‚îÄ‚îÄ‚îê
                         ‚îÇ
üî∫ Source B ‚îÄ‚îÄRegister‚îÄ‚îÄ‚î§‚îÄ‚îÄ‚ñ∂ üéØ RP ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚ñ∂ [LHR1] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 1
                         ‚îÇ             ‚îÇ
üî∫ Source C ‚îÄ‚îÄRegister‚îÄ‚îÄ‚îò              ‚îú‚îÄ‚îÄ‚ñ∂ [LHR2] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 2
                                       ‚îî‚îÄ‚îÄ‚ñ∂ [LHR3] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 3

"RP = Ponto onde origens se ANUNCIAM e receptores se CONECTAM"
```

### Funcionamento do RP

**Fun√ß√£o Principal:**

- **Descoberta de Origens:** Permite que receptores encontrem origens ativas  
- **Ponto de Converg√™ncia:** Local central para constru√ß√£o da √°rvore multicast
- **Redu√ß√£o de Estado:** Menos entradas de roteamento nos roteadores
- **Escalabilidade:** Suporta m√∫ltiplas origens e receptores por grupo

**Processo em 3 Etapas:**

```text
1. REGISTRO DAS ORIGENS:
   üî∫ Source ‚Üí [FHR] ‚îÄ‚îÄPIM Register‚îÄ‚îÄ‚ñ∂ üéØ RP
   "Origens se anunciam para o RP"

2. SOLICITA√á√ÉO DOS RECEPTORES:
   üíª Receiver ‚Üí [LHR] ‚îÄ‚îÄPIM Join (*,G)‚îÄ‚îÄ‚ñ∂ üéØ RP
   "Receptores solicitam grupos ao RP"

3. DISTRIBUI√á√ÉO DO TR√ÅFEGO:
   üî∫ Source ‚Üí üéØ RP ‚Üí [LHR] ‚Üí üíª Receiver
   "RP coordena a entrega via Shared Tree"
```

### Por que precisamos de um RP?

**Problema sem RP:**

```text
‚ùå Sem RP - Como receptor encontra origem?

üî∫ Source (192.168.1.10) transmitindo para 239.1.1.1
üíª Receiver quer receber 239.1.1.1

Pergunta: "Onde est√° a origem 192.168.1.10?"
Resposta: "N√£o sabemos! ü§∑‚Äç‚ôÇÔ∏è"
```

**Solu√ß√£o com RP:**

```text
‚úÖ Com RP - Ponto central de descoberta

üî∫ Source se registra: "Estou transmitindo 239.1.1.1"
üíª Receiver solicita: "Quero receber 239.1.1.1"
üéØ RP conecta: "Source est√° ativa, aqui est√° o tr√°fego!"
```

## Tipos de Configura√ß√£o de RP

Existem diferentes m√©todos para configurar e descobrir RPs em uma rede PIM:

### 1. Static RP (RP Est√°tico)

**Caracter√≠sticas:**  

- Configura√ß√£o manual em todos os roteadores
- Simples de implementar em redes pequenas
- N√£o possui redund√¢ncia autom√°tica
- Adequado para ambientes controlados

**Representa√ß√£o:**  

```text
Configura√ß√£o Static RP:

[R1] ‚îÄ‚îÄ‚îê
[R2] ‚îÄ‚îÄ‚î§ ip pim rp-address 10.1.1.1 (configura√ß√£o manual)
[R3] ‚îÄ‚îÄ‚î§ ip pim rp-address 10.1.1.1 (em todos os roteadores)
[R4] ‚îÄ‚îÄ‚îò

üéØ RP = 10.1.1.1 (definido estaticamente)
```

### 2. Auto-RP (Cisco Propriet√°rio)

**Caracter√≠sticas:**  

- Protocolo propriet√°rio da Cisco
- Discovery autom√°tica de RPs candidatos
- Utiliza grupos especiais 224.0.1.39 e 224.0.1.40
- Funciona apenas em equipamentos Cisco

**Processo Auto-RP:**

```text
Auto-RP Process:

1. RP Candidate anuncia:
   [RP Candidate] ‚îÄ‚îÄ‚ñ∂ 224.0.1.39 (RP-ANNOUNCE)
   "Sou candidato a RP para grupos X"

2. Mapping Agent coleta e distribui:
   [Mapping Agent] ‚îÄ‚îÄ‚ñ∂ 224.0.1.40 (RP-DISCOVERY)
   "RP para grupos X √© 10.1.1.1"

3. Todos os roteadores aprendem:
   [All Routers] ‚óÄ‚îÄ‚îÄ 224.0.1.40
   "OK, RP para X √© 10.1.1.1"
```

### 3. Bootstrap Router (BSR) - RFC 5059

**Caracter√≠sticas:**  

- Padr√£o RFC (interoper√°vel entre vendors)
- Elei√ß√£o autom√°tica de Bootstrap Router
- Distribui√ß√£o de informa√ß√µes de RP por flooding
- Suporte nativo √† redund√¢ncia

**Processo BSR:**

```text
BSR Process:

1. Elei√ß√£o do BSR:
   [Candidates] ‚îÄ‚îÄBootstrap Messages‚îÄ‚îÄ‚ñ∂ [BSR Eleito]
   "Maior prioridade/IP vence"

2. RP Candidates anunciam:
   [RP Candidates] ‚îÄ‚îÄ‚ñ∂ [BSR] ‚îÄ‚îÄ‚ñ∂ RP-Set Message
   "Coleta candidatos e distribui mapeamento"

3. Flooding para toda rede:
   [BSR] ‚îÄ‚îÄflood‚îÄ‚îÄ‚ñ∂ [All PIM Routers]
   "Todos aprendem mapeamento RP‚ÜîGrupos"
```

### 4. Anycast RP - RFC 4610

**Caracter√≠sticas:**  

- Alta disponibilidade e load balancing
- M√∫ltiplos RPs com mesmo endere√ßo IP
- Sincroniza√ß√£o via MSDP (Multicast Source Discovery Protocol)
- Ideal para redes grandes e cr√≠ticas

**Representa√ß√£o Anycast RP:**

```text
Anycast RP - Redund√¢ncia:

üéØ RP1 (10.1.1.100) ‚îÄ‚îÄMSDP‚îÄ‚îÄ‚îê
                             ‚îú‚îÄ‚îÄ Sincroniza√ß√£o
üéØ RP2 (10.1.1.100) ‚îÄ‚îÄMSDP‚îÄ‚îÄ‚î§    de estado
                             ‚îÇ
üéØ RP3 (10.1.1.100) ‚îÄ‚îÄMSDP‚îÄ‚îÄ‚îò

"Mesmo IP, m√∫ltiplos roteadores f√≠sicos"  
"Roteamento unicast determina RP mais pr√≥ximo"
```

### 5. Embedded RP (IPv6)

**Caracter√≠sticas:**  

- Espec√≠fico para IPv6
- Endere√ßo do RP embutido no endere√ßo do grupo
- N√£o requer configura√ß√£o adicional
- Auto descoberta baseada no pr√≥prio endere√ßo

```text
Embedded RP (IPv6):

Grupo: FF7X:0240:RPIP::/96
       ‚îÇ    ‚îÇ    ‚îÇ
       ‚îÇ    ‚îÇ    ‚îî‚îÄ IP do RP embutido
       ‚îÇ    ‚îî‚îÄ Embedded RP flag
       ‚îî‚îÄ Escopo multicast

Exemplo: FF75:0240:2001:DB8::1::/96
         RP = 2001:DB8::1
```

## Processo de Funcionamento do RP

### Fluxograma - Processo Completo do RP

```mermaid
flowchart TD
    A["üî∫ Source inicia transmiss√£o"] --> B["FHR detecta novo fluxo"]
    B --> C["FHR envia PIM Register para RP"]
    C --> D["üéØ RP recebe Register e aprende sobre Source"]
    D --> E{"Existem receptores?"}
    E -- N√£o --> F["RP envia Register-Stop para FHR"]
    E -- Sim --> G["RP encaminha tr√°fego na Shared Tree"]
    F --> H["FHR para de enviar Registers"]
    G --> I["Receptores recebem via (*,G) tree"]
    I --> J{"SPT Switchover ativo?"}
    J -- Sim --> K["LHR constr√≥i (S,G) tree direta"]
    J -- N√£o --> L["Permanece em (*,G) tree via RP"]
    K --> M["Tr√°fego flui por SPT - caminho otimizado"]
    L --> N["Tr√°fego flui por RPT - via RP"]

%% Estilos
style A fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style B fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style C fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style D fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style E fill:#fca5a5,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style F fill:#fca5a5,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style G fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style H fill:#fca5a5,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style I fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style J fill:#fca5a5,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style K fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style L fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style M fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style N fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
```

**Detalhamento do Processo:**

**Fase 1 - Register Process:**  

```text
1. Source transmite ‚Üí FHR detecta novo fluxo
2. FHR encapsula pacotes ‚Üí PIM Register ‚Üí RP
3. RP aprende sobre nova source (S,G)
4. RP verifica se h√° receptores para G
```

**Fase 2 - Join Process:**  

```text
5. Receptor envia IGMP Join ‚Üí LHR
6. LHR envia PIM Join (*,G) ‚Üí upstream direction ‚Üí RP
7. Shared Tree (*,G) √© constru√≠da
8. RP conecta source √† √°rvore de distribui√ß√£o
```

**Fase 3 - Traffic Flow:**  

```text
9. Tr√°fego flui: Source ‚Üí FHR ‚Üí RP ‚Üí LHR ‚Üí Receiver
10. RP pode enviar Register-Stop se tr√°fego flui diretamente
11. Poss√≠vel migra√ß√£o para SPT (S,G) para otimizar caminho
```

## Configura√ß√£o de RPs

### Static RP - Configura√ß√£o Manual

**Cisco IOS:**

```cisco
! Configurar RP est√°tico para todos os grupos
Router(config)# ip pim rp-address 10.1.1.1

! Configurar RP para grupos espec√≠ficos
Router(config)# access-list 10 permit 239.1.0.0 0.0.255.255
Router(config)# ip pim rp-address 10.1.1.1 10

! Verificar RP
Router# show ip pim rp mapping
```

**Vantagens:**  

- Simples e direto
- Controle total sobre sele√ß√£o
- Previs√≠vel e determin√≠stico

**Desvantagens:**  

- Configura√ß√£o manual em todos os roteadores
- Sem redund√¢ncia autom√°tica
- Dif√≠cil manuten√ß√£o em redes grandes

### Auto-RP - Configura√ß√£o Cisco

**RP Candidate:**

```cisco
! Configurar como candidato a RP
Router(config)# ip pim send-rp-announce loopback0 scope 16 group-list 10
Router(config)# access-list 10 permit 239.1.0.0 0.0.255.255

! Configurar interface para an√∫ncios
Router(config)# interface loopback0
Router(config-if)# ip pim sparse-mode
```

**Mapping Agent:**

```cisco
! Configurar Mapping Agent
Router(config)# ip pim send-rp-discovery loopback0 scope 16

! Habilitar Auto-RP listener em interfaces
Router(config)# ip pim autorp listener
```

**Caracter√≠sticas Auto-RP:**  

- Usa grupos 224.0.1.39 (RP-ANNOUNCE) e 224.0.1.40 (RP-DISCOVERY)
- Scope controla TTL dos an√∫ncios
- Mapping Agent pode ser diferente do RP

### BSR - Configura√ß√£o Padr√£o RFC

**Bootstrap Router:**

```cisco
! Configurar BSR candidato
Router(config)# ip pim bsr-candidate loopback0 30 10

! BSR hash mask (para load balancing)
Router(config)# ip pim bsr-candidate loopback0 hash-mask-len 30 priority 10
```

**RP Candidate:**

```cisco
! Configurar RP candidato
Router(config)# access-list 10 permit 239.1.0.0 0.0.255.255
Router(config)# ip pim rp-candidate loopback0 group-list 10 priority 50

! Verificar BSR
Router# show ip pim bsr-router
Router# show ip pim rp mapping
```

**Vantagens BSR:**  

- Padr√£o RFC (interoper√°vel)
- Elei√ß√£o autom√°tica de BSR
- Suporte nativo √† redund√¢ncia
- Hash function para load balancing

### Anycast RP - Alta Disponibilidade

**Configura√ß√£o Anycast RP:**

```cisco
! Configura√ß√£o no RP1
Router1(config)# ip pim rp-address 10.1.1.100
Router1(config)# ip msdp peer 10.2.2.2 connect-source loopback0

! Configura√ß√£o no RP2  
Router2(config)# ip pim rp-address 10.1.1.100
Router2(config)# ip msdp peer 10.1.1.1 connect-source loopback0

! Loopback com mesmo IP (Anycast)
Router1(config)# interface loopback1
Router1(config-if)# ip address 10.1.1.100 255.255.255.255

Router2(config)# interface loopback1  
Router2(config-if)# ip address 10.1.1.100 255.255.255.255
```

**MSDP (Multicast Source Discovery Protocol):**  

- Sincroniza informa√ß√µes de sources entre RPs
- Permite redund√¢ncia transparente
- Suporta load balancing autom√°tico

## Sele√ß√£o e Descoberta de RPs

### Processo de Sele√ß√£o do RP

**Prioridade de Sele√ß√£o:**

```text
1. Static RP (configura√ß√£o manual)
   ‚Üì Maior prioridade - sempre usado se configurado

2. Auto-RP discovery  
   ‚Üì Segundo em prioridade

3. BSR discovery
   ‚Üì Menor prioridade - usado se outros n√£o dispon√≠veis

4. Embedded RP (IPv6 only)
   ‚Üì Extra√≠do do pr√≥prio endere√ßo do grupo
```

**Crit√©rios de Desempate:**

```text
Para m√∫ltiplos RPs candidatos:

1. Maior Priority value (Auto-RP/BSR)
2. Hash function result (BSR)
3. Maior endere√ßo IP (tiebreaker)
```

### Hash Function para Sele√ß√£o de RP

**BSR Hash Algorithm:**

```text
Hash = (G & hash_mask) XOR (C & hash_mask)

Onde:
G = Endere√ßo do grupo multicast
C = Endere√ßo do RP candidato  
hash_mask = M√°scara configurada no BSR

Candidato com maior hash value vence
```

**Exemplo Pr√°tico:**

```text
Grupo: 239.1.1.1
Hash Mask: /30 (255.255.255.252)
RP1: 10.1.1.1, Priority: 100
RP2: 10.1.1.2, Priority: 100

Hash1 = (239.1.1.1 & mask) XOR (10.1.1.1 & mask)
Hash2 = (239.1.1.1 & mask) XOR (10.1.1.2 & mask)

Maior hash vence para este grupo espec√≠fico
```

## RP Tree vs Source Tree

### Compara√ß√£o Visual

**RP Tree (*,G) - Shared Tree:**

```text
üå≥ SHARED TREE via RP:

üî∫ Source A ‚îÄ‚îÄ‚îê
              ‚îú‚îÄ‚îÄ‚ñ∂ üéØ RP ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚ñ∂ [LHR1] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 1  
üî∫ Source B ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚ñ∂ [LHR2] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 2

Caracter√≠sticas:
‚úÖ Menos estado nos roteadores (uma entrada (*,G))
‚úÖ Suporta m√∫ltiplas sources facilmente
‚ùå Caminho pode ser sub√≥timo
‚ùå RP pode ser gargalo
```

**Source Tree (S,G) - SPT:**

```text
üå≤ SOURCE TREE direto:

üî∫ Source A ‚îÄ‚îÄdireto‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚ñ∂ [LHR1] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 1
                      ‚îî‚îÄ‚îÄ‚ñ∂ [LHR2] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 2

üî∫ Source B ‚îÄ‚îÄdireto‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚ñ∂ [LHR1] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 1  
                      ‚îî‚îÄ‚îÄ‚ñ∂ [LHR2] ‚îÄ‚îÄ‚ñ∂ üíª Receiver 2

Caracter√≠sticas:
‚úÖ Caminho otimizado (menor lat√™ncia)
‚úÖ Sem single point of failure
‚ùå Mais estado nos roteadores (uma entrada por source)
‚ùå Complexidade aumenta com muitas sources
```

### SPT Switchover - Migra√ß√£o para Source Tree

**Quando acontece:**

```text
Condi√ß√µes para SPT Switchover:

1. Tr√°fego acima do threshold (default: primeiro pacote)
2. LHR decide migrar para caminho otimizado
3. Source est√° ativa e acess√≠vel via unicast
4. Configura√ß√£o permite SPT (n√£o bloqueado)
```

**Processo de Switchover:**

```mermaid
flowchart TD
    A["Tr√°fego via RP Tree (*,G)"] --> B["LHR detecta tr√°fego de Source S"]
    B --> C["LHR verifica threshold SPT"]
    C --> D{"Threshold atingido?"}
    D -- N√£o --> E["Permanece em (*,G) tree"]  
    D -- Sim --> F["LHR envia PIM Join (S,G) para Source"]
    F --> G["SPT (S,G) √© constru√≠da"]
    G --> H["Tr√°fego migra para SPT"]
    H --> I["LHR envia Prune (*,G) para RP"]
    I --> J["RP remove LHR da (*,G) tree"]

style A fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style B fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold  
style C fill:#fef08a,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style D fill:#fca5a5,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style E fill:#fca5a5,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style F fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style G fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style H fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style I fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
style J fill:#86efac,stroke:#000,stroke-width:1px,color:#000,font-weight:bold
```

**Controle de SPT Switchover:**

```cisco
! Desabilitar SPT switchover (permanecer em RP Tree)
Router(config)# ip pim spt-threshold infinity

! Configurar threshold espec√≠fico
Router(config)# ip pim spt-threshold 100

! Configurar por grupo
Router(config)# access-list 10 permit 239.1.0.0 0.0.255.255  
Router(config)# ip pim spt-threshold infinity group-list 10
```

## Troubleshooting de RPs

### Comandos de Verifica√ß√£o

**Verificar RP Mapping:**

```cisco
Router# show ip pim rp mapping
PIM Group-to-RP Mappings

Group(s) 224.0.0.0/4
  RP: 10.1.1.1 (loopback0), v2v1
      Info source: 10.1.1.1 (loopback0), elected via Auto-RP
           Uptime: 00:05:23, expires: 00:02:36

Group(s) 239.1.0.0/16  
  RP: 10.2.2.2 (loopback0), v2v1
      Info source: 10.2.2.2 (loopback0), via bootstrap, priority 0, holdtime 150
           Uptime: 00:10:15, expires: 00:02:15
```

**Verificar Estado do RP:**

```cisco
Router# show ip pim rp
Group: 239.1.1.1, RP: 10.1.1.1, uptime 00:05:23, expires 00:02:36
  RP: 10.1.1.1 (loopback0), v2v1
      Info source: 10.1.1.1 (loopback0), elected via Auto-RP
           Uptime: 00:05:23, expires: 00:02:36

! Verificar se roteador √© RP para algum grupo
Router# show ip pim rp-hash 239.1.1.1
  RP: 10.1.1.1 (Loopback0)
    Info source: 10.1.1.1, via Auto-RP
```

**Verificar Register Process:**

```cisco
Router# show ip pim interface
Address          Interface                Ver/ Nbr    Query  DR  DR
                                         Mode Count   Intvl  Prior
10.1.1.1         Loopback0                v2/S  0       30    1   10.1.1.1
192.168.1.1      FastEthernet0/0          v2/S  1       30    1   192.168.1.2

Router# show ip pim neighbor  
PIM Neighbor Table
Mode: B - Bidir Capable, DR - Designated Router, N - Default DR Priority,
      P - Proxy Capable, S - State Refresh Capable, G - GenID Capable,
      L - DR Load-balancing Capable

Neighbor          Interface                Uptime/Expires    Ver   DR
Address                                                            Prio/Mode
192.168.1.2       FastEthernet0/0          00:15:23/00:01:36 v2    1 / S P G
```

### Problemas Comuns

**1. RP n√£o responde a Registers:**

```text
Sintomas:
- Sources n√£o aparecem na tabela multicast do RP
- show ip pim rp n√£o mostra sources registradas
- Tr√°fego multicast n√£o flui

Diagn√≥stico:
Router# debug ip pim rp
Router# show ip pim rp-hash <group>
Router# show ip mroute <group> <source>

Poss√≠veis Causas:
- RP address incorreto
- Conectividade unicast FHR‚ÜîRP quebrada  
- ACL bloqueando PIM Register packets
- MTU issues com encapsulamento Register
```

**2. Receptores n√£o recebem tr√°fego:**

```text  
Sintomas:
- IGMP Join vis√≠vel no LHR mas sem tr√°fego
- (*,G) entry existe mas sem incoming traffic
- RP recebe Register mas n√£o encaminha

Diagn√≥stico:
Router# show ip mroute <group>
Router# show ip pim rp <group>  
Router# debug ip pim <group>

Poss√≠veis Causas:
- RP n√£o est√° na √°rvore SPF para LHR
- PIM Join n√£o chegando ao RP
- RPF failure na dire√ß√£o RP‚ÜíLHR
```

**3. M√∫ltiplos RPs conflitantes:**

```text
Sintomas:  
- Diferentes roteadores usam RPs diferentes
- Tr√°fego intermitente ou inconsistente
- show ip pim rp mapping mostra conflitos

Diagn√≥stico:
Router# show ip pim rp mapping
Router# show ip pim autorp
Router# show ip pim bsr-router

Solu√ß√µes:
- Verificar consist√™ncia de configura√ß√£o
- Analisar prioridades Auto-RP/BSR
- Confirmar conectividade entre candidatos
```

## Otimiza√ß√£o e Melhores Pr√°ticas

### Placement Strategy (Estrat√©gia de Posicionamento)

**Crit√©rios para Posicionamento do RP:**

```text
üéØ RP Placement - Fatores Cr√≠ticos:

1. CENTRALIDADE TOPOL√ìGICA:
   ‚îú‚îÄ Pr√≥ximo ao core da rede
   ‚îú‚îÄ Menor n√∫mero de hops para edges  
   ‚îî‚îÄ Evitar single points of failure

2. CAPACIDADE DO EQUIPAMENTO:
   ‚îú‚îÄ CPU suficiente para Register processing
   ‚îú‚îÄ Mem√≥ria para tabelas multicast grandes
   ‚îî‚îÄ Largura de banda adequada

3. CONECTIVIDADE:
   ‚îú‚îÄ M√∫ltiplos caminhos para redund√¢ncia
   ‚îú‚îÄ Baixa lat√™ncia para sources/receivers
   ‚îî‚îÄ Links confi√°veis e est√°veis
```

**Exemplo de Placement:**

```text
RUIM - RP na borda:
[Core] ‚îÄ‚îÄlong path‚îÄ‚îÄ‚ñ∂ üéØ RP (Edge) ‚óÄ‚îÄ‚îÄsources/receivers
"Alto delay, single point failure"

BOM - RP no core:
     üéØ RP (Core)
    /      |      \
[Edge1] [Edge2] [Edge3]
"Baixo delay, m√∫ltiplos caminhos"
```

### Redund√¢ncia e Failover  

**Estrat√©gias de Redund√¢ncia:**

**1. Anycast RP:**

```