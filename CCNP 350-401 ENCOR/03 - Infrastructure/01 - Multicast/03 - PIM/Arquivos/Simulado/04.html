<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulado Multicast - 04</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-6">

  <div class="w-full max-w-2xl bg-white shadow-lg rounded-xl p-6">
    <div id="start-screen" class="text-center">
      <h1 class="text-2xl font-bold mb-4">Simulado Multicast - IGMP (Parte 1)</h1>
      <p class="mb-6 text-slate-600">Este simulado contém 10 questões sobre IGMP. Você terá 10 minutos para concluir.</p>
      <div class="max-w-sm mx-auto mb-4">
        <label for="user-name" class="block text-left text-sm font-medium text-slate-700 mb-1">Seu nome</label>
        <input id="user-name" type="text" placeholder="Digite seu nome" class="w-full px-3 py-2 rounded-lg border" />
      </div>
      <button onclick="startQuiz()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Iniciar</button>
    </div>

    <div id="quiz-screen" class="hidden">
      <div class="flex justify-between items-center mb-4">
        <span id="question-count" class="text-sm font-semibold text-slate-500">Questão 1 de 10</span>
        <span id="quiz-timer" class="text-sm font-semibold text-slate-500">10:00</span>
      </div>
      <h2 id="question-text" class="text-xl font-semibold mb-6"></h2>
      <div id="options-container" class="space-y-3"></div>
      <div class="flex justify-between items-center mt-6">
        <button id="next-btn" onclick="nextQuestion()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 hidden">Próximo</button>
      </div>
    </div>

    <div id="result-screen" class="hidden">
      <h2 class="text-2xl font-bold text-center mb-4">Resultados</h2>
      <p id="score-el" class="text-lg text-center mb-6"></p>
      <div id="review-el"></div>
    </div>
  </div>

<script>
  const SIMULADO_ID = 'simulado_04';
  const SIMULADO_TITULO = 'Simulado Multicast - IGMP (Parte 1)';

  const quizData = [
    {
      "question": "Qual é a principal função do IGMPv2 em comparação com o IGMPv1, que resolve a lentidão na saída de um grupo multicast?",
      "options": ["A introdução de mensagens de adesão atrasadas.", "A implementação de um mecanismo de eleição para o querier multicast.", "A inclusão de uma mensagem de 'Leave Group' (Saída de Grupo).", "O uso de endereços de grupo de multicast de origem específica."],
      "answer": 2,
      "rationale": "O IGMPv2 introduziu a mensagem de 'Leave Group' para permitir que os hosts notifiquem imediatamente o roteador de sua intenção de sair do grupo, acelerando o processo."
    },
    {
      "question": "Em um ambiente com múltiplos roteadores em uma mesma interface, o processo de eleição do 'Querier' (Consultor) do IGMPv2 é baseado em qual critério?",
      "options": ["O roteador com a maior prioridade configurada.", "O roteador com o maior endereço IP da interface.", "O primeiro roteador a iniciar a troca de mensagens de consulta.", "O roteador com o menor endereço IP da interface."],
      "answer": 3,
      "rationale": "No IGMPv2, o roteador com o menor endereço IP da interface que está enviando consultas multicast é eleito como o 'Querier' para o segmento de rede."
    },
    {
      "question": "O IGMP Snooping é uma funcionalidade essencial para otimizar o tráfego multicast em qual tipo de dispositivo de rede?",
      "options": ["Roteadores de Borda (Edge Routers).", "Servidores DNS.", "Switches de Camada 2.", "Firewalls de Inspeção de Estado (Stateful Firewalls)."],
      "answer": 2,
      "rationale": "O IGMP Snooping permite que switches de Camada 2 inspecionem mensagens IGMP e encaminhem o tráfego multicast apenas para as portas onde os hosts estão interessados, evitando que o tráfego seja enviado para todas as portas."
    },
    {
      "question": "Qual é a principal diferença entre os modos 'Include' e 'Exclude' do IGMPv3?",
      "options": ["O modo 'Include' aceita todos os tráfegos, enquanto o 'Exclude' bloqueia apenas um tipo de tráfego.", "O modo 'Include' lista as fontes que o host quer receber tráfego, enquanto o 'Exclude' lista as que o host não quer receber.", "O modo 'Include' é usado para IPv4, e o 'Exclude' para IPv6.", "O modo 'Include' é a versão legada do modo 'Exclude'."],
      "answer": 1,
      "rationale": "O modo 'Include' (ISL) permite ao host especificar explicitamente a lista de fontes das quais deseja receber o tráfego multicast. O modo 'Exclude' (ESL) permite ao host receber tráfego de todas as fontes, exceto aquelas listadas como excluídas."
    },
    {
      "question": "Um host deseja ingressar no grupo multicast `239.1.1.1` e receber tráfego apenas da fonte `10.1.1.50`. Qual tipo de mensagem o host enviará, e qual modo do IGMPv3 ele utilizará?",
      "options": ["Um 'Leave Group' no modo 'Exclude' para `10.1.1.50`.", "Um 'Group Membership Report' no modo 'Exclude' para `239.1.1.1`.", "Um 'Group Membership Report' no modo 'Include' para `239.1.1.1` e fonte `10.1.1.50`.", "Um 'General Query' com `10.1.1.50` como endereço de grupo."],
      "answer": 2,
      "rationale": "O host deve enviar um 'Report' (Relatório de Adesão) usando o modo 'Include' para notificar o roteador de que ele deseja receber o tráfego para o grupo `239.1.1.1` especificamente da fonte `10.1.1.50`."
    },
    {
      "question": "O que ocorre com o 'Time-to-Live' (TTL) de um pacote de multicast quando ele é enviado com o valor 1?",
      "options": ["Ele é entregue a todos os hosts na rede local e enviado para o próximo roteador.", "Ele é descartado pelo primeiro roteador que o recebe, pois o TTL se torna 0.", "O pacote é enviado para toda a rede, pois o TTL não é relevante para o tráfego multicast.", "O pacote é enviado para toda a rede local e, se não for recebido, é encaminhado para o próximo salto."],
      "answer": 1,
      "rationale": "Quando um pacote com TTL=1 é enviado, ele chega ao primeiro roteador, que decrementa o TTL para 0 e o descarta, pois o valor do TTL se tornou inválido para encaminhamento."
    },
    {
      "question": "Em um cenário de roteamento multicast, qual dos endereços a seguir é usado por um roteador IGMP para enviar consultas a todos os hosts e roteadores em um segmento de rede?",
      "options": ["224.0.0.1", "224.0.0.2", "224.0.0.3", "224.0.0.22"],
      "answer": 0,
      "rationale": "O endereço '224.0.0.1' é o endereço 'all-hosts group', usado para enviar mensagens para todos os hosts multicast em uma rede local."
    },
    {
      "question": "Qual das seguintes afirmações sobre o IGMPv1 está incorreta?",
      "options": ["O roteador envia 'General Queries' para todos os hosts em um segmento de rede.", "Não existe um mecanismo explícito para um host notificar sua saída de um grupo.", "O roteador com o menor endereço IP se torna o 'Querier'.", "Os hosts respondem com um 'Membership Report' para cada grupo do qual são membros."],
      "answer": 2,
      "rationale": "A eleição do 'Querier' com base no menor endereço IP foi introduzida no IGMPv2. No IGMPv1, o primeiro roteador a enviar uma consulta se torna o 'Querier'."
    },
    {
      "question": "Qual das seguintes opções descreve a principal melhoria do IGMPv3 em relação ao IGMPv2?",
      "options": ["A introdução de mensagens de 'Leave Group' para saídas mais rápidas.", "A capacidade de os hosts filtrarem o tráfego com base na fonte (Source-Specific Multicast).", "O uso de consultas gerais para verificar a presença de membros nos grupos.", "A simplificação do processo de eleição do roteador 'Querier'."],
      "answer": 1,
      "rationale": "O IGMPv3 introduziu o Source-Specific Multicast (SSM), que permite aos hosts especificar quais fontes de um grupo multicast eles desejam ouvir ou ignorar."
    },
    {
      "question": "Considere o seguinte cenário: Um roteador multicast envia um 'General Query' (Consulta Geral) na interface `gigabitethernet 0/1`. Qual é o endereço IP de destino desta mensagem?",
      "options": ["O endereço IP de multicast do grupo específico, por exemplo, `239.1.1.1`.", "O endereço IP 'all-routers group' (`224.0.0.2`).", "O endereço IP de broadcast da rede, por exemplo, `192.168.1.255`.", "O endereço IP 'all-hosts group' (`224.0.0.1`)."],
      "answer": 3,
      "rationale": "O 'General Query' tem o objetivo de descobrir todos os hosts membros de todos os grupos em um segmento, e, portanto, é enviado para o endereço reservado 'all-hosts group' (`224.0.0.1`)."
    }
  ];
  
  // --- Código JavaScript do Quiz (pode ser reutilizado de 01.html) ---
  const startScreen = document.getElementById('start-screen');
  const quizScreen = document.getElementById('quiz-screen');
  const resultScreen = document.getElementById('result-screen');
  const questionText = document.getElementById('question-text');
  const optionsContainer = document.getElementById('options-container');
  const nextBtn = document.getElementById('next-btn');
  const questionCount = document.getElementById('question-count');
  const quizTimer = document.getElementById('quiz-timer');
  const scoreEl = document.getElementById('score-el');
  const reviewEl = document.getElementById('review-el');
  const userNameInput = document.getElementById('user-name');
  
  let currentQuestionIndex = 0;
  let userAnswers = [];
  let score = 0;
  let timer;
  let timeSpentSeconds = 0;
  let currentUserName = '';

  const MAX_TIME = 600; // 10 minutes

  function formatSeconds(secs) {
      const minutes = Math.floor(secs / 60);
      const seconds = secs % 60;
      return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }

  function startQuiz() {
      const name = userNameInput.value.trim();
      if (!name) {
          alert("Por favor, digite seu nome para começar.");
          return;
      }
      currentUserName = name;
      startScreen.classList.add('hidden');
      quizScreen.classList.remove('hidden');
      timeSpentSeconds = 0;
      quizTimer.textContent = formatSeconds(MAX_TIME);
      userAnswers = [];
      score = 0;
      currentQuestionIndex = 0;
      timer = setInterval(() => {
          timeSpentSeconds++;
          quizTimer.textContent = formatSeconds(MAX_TIME - timeSpentSeconds);
          if (timeSpentSeconds >= MAX_TIME) {
              endQuiz();
          }
      }, 1000);
      showQuestion();
  }

  function showQuestion() {
      const question = quizData[currentQuestionIndex];
      questionText.textContent = question.question;
      optionsContainer.innerHTML = '';
      questionCount.textContent = `Questão ${currentQuestionIndex + 1} de ${quizData.length}`;
      nextBtn.classList.add('hidden');

      question.options.forEach((option, index) => {
          const button = document.createElement('button');
          button.textContent = option;
          button.className = 'w-full text-left p-4 border rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors';
          button.onclick = () => selectAnswer(index);
          optionsContainer.appendChild(button);
      });
  }

  function selectAnswer(selectedIndex) {
      if (userAnswers[currentQuestionIndex] !== undefined) return;
      userAnswers[currentQuestionIndex] = selectedIndex;
      
      const isCorrect = (selectedIndex === quizData[currentQuestionIndex].answer);
      if (isCorrect) {
          score++;
      }
      
      const buttons = optionsContainer.getElementsByTagName('button');
      for (let i = 0; i < buttons.length; i++) {
          const button = buttons[i];
          if (i === quizData[currentQuestionIndex].answer) {
              button.classList.add('bg-green-200', 'border-green-600');
          } else if (i === selectedIndex) {
              button.classList.add('bg-red-200', 'border-red-600');
          }
          button.disabled = true;
      }
      nextBtn.classList.remove('hidden');
  }

  function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < quizData.length) {
          showQuestion();
      } else {
          endQuiz();
      }
  }

  function endQuiz() {
    const resultRecord = {
        id: String(Date.now()),
        simuladoId: SIMULADO_ID,
        simuladoTitle: SIMULADO_TITULO,
        name: currentUserName,
        score: score,
        total: quizData.length,
        percent: quizData.length ? (score / quizData.length) * 100 : 0,
        timeSeconds: timeSpentSeconds,
        timeFormatted: formatSeconds(timeSpentSeconds),
        date: new Date().toISOString()
    };

    let results = JSON.parse(localStorage.getItem('quizResults')) || [];
    results.push(resultRecord);
    localStorage.setItem('quizResults', JSON.stringify(results));
      
      clearInterval(timer);
      quizScreen.classList.add("hidden");
      resultScreen.classList.remove("hidden");

      const pct = quizData.length ? Math.round((score/quizData.length)*100) : 0;
      scoreEl.textContent = `Você acertou ${score} de ${quizData.length} questões (${pct}%). Tempo: ${formatSeconds(timeSpentSeconds)}.`;

      reviewEl.innerHTML = quizData.map((q, i) => {
          const isCorrect = userAnswers[i] === q.answer;
          const resultClass = isCorrect ? "bg-green-100 border-green-600" : "bg-red-100 border-red-600";
          const userOptionText = q.options[userAnswers[i]] || 'Não respondida';
          const correctOptionText = q.options[q.answer];

          return `
            <div class="p-4 border rounded-lg ${resultClass} mb-4">
              <p class="font-semibold">Q${i+1}: ${q.question}</p>
              <p class="text-sm">Sua Resposta: <span class="${isCorrect ? 'text-green-600' : 'text-red-600'} font-medium">${userOptionText}</span></p>
              ${!isCorrect ? `<p class="text-sm">Resposta Correta: <span class="text-green-600 font-medium">${correctOptionText}</span></p>` : ''}
              <p class="mt-2 text-sm text-slate-700">Explicação: ${q.rationale}</p>
            </div>
          `;
      }).join('');
  }
</script>
</body>
</html>